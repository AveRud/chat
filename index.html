<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Registration page</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.dev.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<!--    <link rel="stylesheet" href="style.css">-->
</head>
<body>
<style>
    body {
        background: #ececec;

    }

    /*.error {*/
    /*    box-shadow: 0 0 0 1px red;*/
    /*}*/


</style>
<h1 style="color: darkorange">MaybeWorks Chat</h1>

<div class="loginPage">
    <div class="form">
        <form class="registration" onsubmit="">
            <h1>REGISTRATION</h1>
            <input type="text" class="input" name="username" placeholder="username" autocomplete="off" pattern="[0-9a-zA-Z]{3,}"
                   required title="3 characters minimum without special characters" minlength="3">
<!--            <p>Username must be at minimum 3 characters length and without special characters</p>-->
            <input type="password" name="password" placeholder="password" required> <br><br>
            <button onclick="onSubmit(event)">GO</button>
        </form>
    </div>
</div>

<script>
    const getValueByName = (name) =>  document.querySelector(`[name=${name}]`);

    const userSelector = getValueByName('username');
    const passSelector = getValueByName('password');
    // const socket = io.connect('http://localhost:77777');
    // // const socket = io('http://localhost', {path: 'socket.io'});
    // socket.on('connected', function (data) {
    //     console.log(data);
    // });
    const socket = io.connect('http://localhost:4001');
    socket.on('news', function (data) {
        console.log(data);
        socket.emit('myNewEvent', {my: 'data'});
    });

    const onSubmit = async (e) => {
        console.log('e', e.preventDefault());
        getValueByName('username').className = '';

        const username = userSelector.value;
        const password = passSelector.value;

        try {
            let response =  await axios.post('/', {
                username,
                password
            });
            localStorage.setItem('user', JSON.stringify(response.data));
            window.location.href = "/chat";

        } catch (e) {
            userSelector.className = 'error';
            console.log('Login is error');
        }

    };

</script>
</body>
</html>